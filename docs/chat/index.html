<!DOCTYPE html>
<html>
<head>
	<title>chat</title>
	<script type="text/javascript" src="js/jquery-git.js"></script>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/emojify.css">
	<script type="text/javascript" src="js/jquery-git.js"></script>
	<link rel="stylesheet" href="css/fontawesome.min.css">
	<link rel="stylesheet" href="css/fontawesome-all.min.css">
	<script src="js/notify.min.js"></script>
	<script src="js/emojify.js"></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- SEO -->
    <meta name="description" content="Chattez en temps réel avec n'importe qui dans le monde">
    <meta name="author" content="uipasta">
    <meta name="url" content="http://mitashi-otha.com/chat">
    <meta name="copyright" content="Mitashi Otha">
    <meta name="robots" content="index,follow">
    <script src="js/google.js"></script>
    <title>Mitashi Otha - Developpeur Web</title>
    <link rel="shortcut icon" href="">
    <link rel="apple-touch-icon" sizes="144x144" type="image/x-icon" href="images/favicon/apple-touch-icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700">
    <!-- HTML5 shiv and Respond.js support IE8 or Older for HTML5 elements and media queries -->
    <!--[if lt IE 9]>
	   <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <meta property="og:url" content="https://mitashi-otha.com/chat">
    <meta property="og:image" content="http://mitashi-otha.com/chat/coffee.jpg">
     <meta property="og:image:type"  content="jpg">
    <meta property="og:image:width" content="1194">
    <meta property="og:image:height" content="800">
    <meta property="og:title" content="Forum chat real Time">
    <meta property="og:description" content="Chattez en temps réel avec n'importe qui dans le monde">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<style type="text/css">
		.corps{
			width:50%;
			height: 500px;
		}
		body{
			background-color: #a9a9a957
		}
		#message{
			height: 450px;
			width: 100%;
			background-color: #009688
		}
		#mybodyinput{
			height: 50px;
			background-color: #fff;
			position: relative;
		}
		.form-control-lg{
			border:transparent; 
		}
		.form-control-lg:focus{
			box-shadow: none
		}
		.mybtn{
			line-height: 50px
		}
		#inputPseudo{
    width: 100%;
    padding:0px; 
    /* background: red; */
       border-top: 46px solid #fff;
    height: 16px;
    transform: scaleY(-1);
    border-right: 115px solid #fff0;
		}
		#myrow{
			margin: 0;
			position: relative;
		}
		#mypseudo{
			transform: scaleY(-1);
			position: absolute;
			bottom: 0;
		}
		#pusmessage ul{
			list-style: none;
			margin: 0;
			padding-left:1ex 
		}
		#pusmessage ul p{
			font-size: 15pt;
			color: #fff
		}
		.mystyle{
			margin-left: 0 !important;
			margin-right: 0 !important;
			padding-left: 0 !important;
			padding-right: 0 !important;
		}
		#emo li {
    		display: inline;
		}
		#emo {
			margin-left: 0 !important;
			padding-left: 0 !important;
			padding-right: 0 !important;
			text-align: center !important
		}
		.Divemoji:before{
			content: "";
			display: block;
			position: absolute;
			top: -10px;
			right: 177px;
			width: 0;
			height: 0;
			border-bottom: 10px solid #009688;
			border-right: 10px solid transparent;
			border-left: 10px solid transparent;
		}
	.blocsmiley{

	}
	/* Flash class and keyframe animation */
	.flashit{
	  color:#f2f;
		-webkit-animation: flash linear 1s infinite;
		animation: flash linear 1s infinite;
	}
	@-webkit-keyframes flash {
		0% { opacity: 1; } 
		50% { opacity: .1; } 
		100% { opacity: 1; }
	}
	@keyframes flash {
		0% { opacity: 1; } 
		50% { opacity: .1; } 
		100% { opacity: 1; }
	}
	@font-face{
		font-family: "ubuntu";
		src:url("fonts/Ubuntu-Light.ttf") ;
	}
	.panelHead ul{
		list-style: none;
		padding: 0 !important;
	}
	.panelHead ul li{
		display: inline;
	}
	.panelHead ul li:nth-of-type(2){
		margin-left: 1em
	}
	</style>
</head>
<body>
			<script>
(function(a,b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))window.location=b})(navigator.userAgent||navigator.vendor||window.opera,'http://mitashi-otha.com/mobil');
</script>
		<div class="container">
			<div class="row justify-content-md-center ">
					
				   <div class="corps">
						   <div class="panelHead">
								<ul>
									<li>
										<i  data-toggle="tooltip" data-placement="bottom" title="personnes en ligne" class="fas fa-eye-slash vues"></i> <span id="counter" style="font-size: 9pt;">Il n y a personne en ligne</span>
									</li>
									<li>
										<i data-toggle="tooltip" data-placement="bottom" title="vous êtes en ligne" class="fas fa-circle flashit"></i>  <span id="" style="font-size: 9pt;">Vous êtes en ligne</span>
									</li>
								</ul>
							</div>
				   			<div class="row" id="myrow">
				   				<div class="col-9" id="inputPseudo">
				   					<input id="mypseudo" class="form-control form-control-lg" type="text" placeholder="Ecrivez votre pseudo">
				   				</div>
				   			</div>
				   			
					   	<div id="message" style="position: relative;overflow-y: auto;">
					   		<div id="pusmessage" style="position: absolute;bottom: 0;width: 100%;height: 450px;overflow-y: auto;">
					   			<ul style="padding-left: 0;position: absolute;left: 0;right: 0;bottom: 0">
					   				
					   			</ul>
					   		</div>
					   	</div>
					   	<div id="mybodyinput">
					   		<div class="row mystyle">
					   			<div class="col-7 mystyle">
					   				<input id="messages" class="form-control form-control-lg" type="text" placeholder="Tapez le texte">
					   			</div>
					   			<div class="col-2 mystyle blocsmiley" style="text-align:center;cursor: pointer;">
					   				<i class="far fa-smile mybtn" style="font-size: 20pt;color: yellowgreen;"></i>
					   			</div>
					   			<div class="col-3 mybtn mystyle" style="text-align:center">
					   				<button id="monbtn" type="button" class="btn btn-primary">Envoyer</button>
					   			</div>
					   		</div>
						   		<div class="Divemoji" style="display: none;position: absolute;width: 400px;background-color: #009688;height: 200px;right: 0;overflow-y: auto;">
						   		
						   		</div>
					   	</div>
					   	
				   </div>
			</div>
		</div>		
		<script src="https://js.pusher.com/4.1/pusher.min.js"></script>
		<script type="text/javascript">
		$(document).ready(function(){
			 $('[data-toggle="tooltip"]').tooltip()
		})
			$(function($){
				
			
				$(".blocsmiley").on("click",function(e){
					e.stopPropagation()
					$(".Divemoji").show()
								  .load("emoticones.html", function(data, sts, xhr){
					if(xhr.status==200){
						emojify.run();
						$("#emo").on("click","li img",function(e){
											//var elm = $(e.toElement)
											var els = $(this)
											//console.log(els[0].alt)
											let getEmo = els[0].alt
											//let getEmo = elm.attr("alt")
											Ajouter(getEmo)
											//console.log(elm.attr("alt"))
										})
					}
				})
				})
				$(document).on("click",function(){
					$(".Divemoji").hide()
				})
				$(".Divemoji").on("click",function(e){
					e.stopPropagation()
				})
				function Ajouter(b1)
										{
											//Gestion des selections
											var mess = document.getElementById('messages');
											if (document.selection)
											//Pour Internet Explorer
											{
											var str = document.selection.createRange().text;
											mess.focus();
											sel = document.selection.createRange();
											sel.text = b1 + str;
											}
											else
											{
											//Pour les autres
											var startPos = mess.selectionStart;
											var endPos = mess.selectionEnd;
											var chaine = mess.value;
											var str = chaine.substring( mess.selectionStart, mess.selectionEnd );
											mess.value = chaine.substring(0, startPos) + b1 + str
											+ chaine.substring(endPos, chaine.length);
											}
											mess.focus();
										}


				//console.log("seText", (new Date()).getTime())
				if(NodeList.prototype.forEach==undefined){
					NodeList.prototype.forEach = function(callback){
						[].forEaach.call(this, callback)
					}
				}
			    Pusher.logToConsole = true;

			    var pusher = new Pusher('47947edf508104165c7b', {
			      cluster: 'eu',
			      encrypted: true
			    });
			    let terms = [
			     {
			    	time:10,
			    	divide:1,
			    	counter:5,
			    	text:"%d secondes"
			    },
			    {
			    	time:45,
			    	divide:1,
			    	counter:5,
			    	text:"moins d'une minute"
			    },
			    {
			    	time:360,
			    	divide:60,
			    	counter:5,
			    	text:"%d minutes"
			    },
			    {
			    	time:3500,
			    	divide:60,
			    	counter:5,
			    	text:"%d minutes"
			    },
			    {
			    	time:3600,
			    	divide:120,
			    	counter:5,
			    	text:"environs 1 heure"
			    }
			    ]
			    var channel = pusher.subscribe('my-channel');
			   $.getJSON("https://api.ipify.org?format=jsonp&callback=?",
			      function(json) {
			        console.log("My public IP address is: ", json.ip);
			        var ip = json.ip
			        var session = localStorage.getItem("ticket") || []
			        var loc = localStorage.getItem("ticket")
			        console.log(loc)
			        	if(session.length>=1){
			        		return
			        	}else{
			        		localStorage.setItem("ticket", ip)
						 setTicket = $.ajax({
								type:"POST",
								url:"http://www.kepler.agency/anthony/pusher/index.php",
								data:{ip:encodeURIComponent(ip)}
							}).done(function(data){

							})
			        	}
			      }
			    );
			    channel.bind('my-event', function(data) {
			      //alert(data.message);
			      var pseudo = $("#mypseudo").val()
			      var son = new Audio("notif.mp3")
			      var color = "#fff"
			     
			      var temps = (new Date()).getTime() /1000
			      if(data.inline){
			      		//alert("il y a 1 personne en ligne !")
			      		let counter= 0
			      		var loc = localStorage.getItem("ticket")
			      		if(data.line !==loc ){
			      			counter =+1
			      			$(".vues").removeClass("fa-eye-slash").addClass("fa-eye")
			      			$("#counter").html("Il y a "+counter+" personne(s) en ligne")
			      		}
			      		
			      }else{
			      	 if(data.pseudo == pseudo){
			      	color = "#8cf403"
			      }else{
			      	son.play()
			      }
			      	$("#pusmessage ul").append("<li style='padding-left:1ex'><p style='font-family:ubuntu'><b style='color:"+color+"'>"+data.pseudo+ "</b> " +data.message+"<font data-ago="+temps+" style='margin-left: 1em;font-size:8pt'></font></p></li><hr>")
			      emojify.run();
			    		timer()
			    	}
			    });
			    function timer(){
				    document.querySelectorAll("[data-ago]").forEach(function(node){
				    //let secondes= node.getAttribute('data-ago')
				    function setText(){
					   let secondes=Math.round((new Date()).getTime()/1000-parseInt(node.dataset.ago, 10))
					
					   let prefixe = secondes >= 0? 'Il y a ' : 'Dans '

					  // console.log("secondes", secondes)
					   let wording=''
					   secondes = Math.abs(secondes)
					   let term = null
					   for(term of terms){
					   	console.log("termes", term.time)
					   		if(secondes < term.time){
					   			break
					   		}
					   }
					   let Nextick = secondes % term.divide
					   
					   if(Nextick==0){
					   	Nextick=term.divide
					   }
					//  console.log("Nextick", Nextick) 
					   node.innerHTML = prefixe + term.text.replace("%d", Math.round(secondes/term.divide))
					   window.setTimeout(function(){
						   	if(window.requestAnimationFrame){
						   		window.requestAnimationFrame(setText)
						   	}else{
						   		setText()
						   	}
					   }, Nextick*1000)
				    }
				   setText()
				    })
			    }
			    $("#monbtn").click(function(){
			    	var pseudo = $("#mypseudo").val()
				var message = $("#messages").val()
					if((pseudo.length<=0)|| message<=0 ){
						if(pseudo.length<=0) $("#myrow").notify("Quel est ton pseudo ?", {className: 'info',position: 'left'})
						return
					}
				$("#messages").val("")
				$.ajax({
					type:"POST",
					url:"http://www.kepler.agency/anthony/pusher/index.php",
					data:{message:message, pseudo:pseudo}
				}).done(function(){
					
				})
			  })	
			})
		</script>
</body>
</html>